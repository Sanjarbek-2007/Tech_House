<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Profile | Tech House</title>
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="../styles/global.css">
  <link rel="stylesheet" href="../styles/cart.css"> <!-- Reusing navbar styles -->
  <link rel="stylesheet" href="../styles/profile.css"> <!-- Specific Profile Styles -->
  <link rel="stylesheet" href="../styles/toast.css">
  <link rel="icon" href="../photos/icons/logo_w.svg">
</head>

<body>

  <!-- OVERLAYS -->
  <div class="sidebar-overlay" id="overlay" onclick="toggleMenu()"></div>

  <!-- MOBILE SIDEBAR MENU -->
  <div class="mobile-sidebar" id="mobileSidebar">
    <div class="sidebar-mobile-header">
      <span>Product Categories</span>
      <i data-lucide="x" onclick="toggleMenu()"></i>
    </div>

    <div class="cat-group" onclick="this.classList.toggle('open')">
      <div class="cat-header"><i data-lucide="utensils"></i> <a
          href="appliances_page.html?category=Kitchen Appliances">Kitchen Appliances</a></div>
      <ul class="cat-list">
        <li><a href="appliances_page.html?search=Stand Mixers">Stand Mixers</a></li>
        <li><a href="appliances_page.html?search=Microwave">Microwave Ovens</a></li>
        <li><a href="appliances_page.html?search=Convection">Convection Ovens</a></li>
        <li><a href="appliances_page.html?search=Blender">Power Blenders</a></li>
        <li><a href="appliances_page.html?search=Air Fryer">Air Fryers</a></li>
        <li><a href="appliances_page.html?search=Food Processor">Food Processors</a></li>
        <li><a href="appliances_page.html?search=Coffee">Coffee Makers</a></li>
        <li><a href="appliances_page.html?search=Toaster">Toasters & Grills</a></li>
      </ul>
    </div>

    <div class="cat-group" onclick="this.classList.toggle('open')">
      <div class="cat-header"><i data-lucide="wind"></i> <a
          href="appliances_page.html?category=Cleaning Appliances">Cleaning Appliances</a></div>
      <ul class="cat-list">
        <li><a href="appliances_page.html?search=Robot Vacuum">Robot Vacuums</a></li>
        <li><a href="appliances_page.html?search=Steam Cleaner">Steam Cleaners</a></li>
        <li><a href="appliances_page.html?search=Wet Vacuum">Wet/Dry Vacuums</a></li>
        <li><a href="appliances_page.html?search=Air Purifier">Air Purifiers</a></li>
        <li><a href="appliances_page.html?search=Pressure Washer">Pressure Washers</a></li>
        <li><a href="appliances_page.html?search=Handheld Vacuum">Handheld Vacuums</a></li>
        <li><a href="appliances_page.html?search=Carpet Cleaner">Carpet Cleaners</a></li>
        <li><a href="appliances_page.html?search=Window Cleaner">Window Cleaners</a></li>
      </ul>
    </div>

    <div class="cat-group" onclick="this.classList.toggle('open')">
      <div class="cat-header"><i data-lucide="thermometer"></i> <a
          href="appliances_page.html?category=Heating Appliances">Heating & Cooling</a></div>
      <ul class="cat-list">
        <li><a href="appliances_page.html?search=Heater">Space Heaters</a></li>
        <li><a href="appliances_page.html?search=Fan">Ceiling Fans</a></li>
        <li><a href="appliances_page.html?search=Air Conditioner">Air Conditioners</a></li>
        <li><a href="appliances_page.html?search=Dehumidifier">Dehumidifiers</a></li>
        <li><a href="appliances_page.html?search=Cooler">Evaporative Coolers</a></li>
        <li><a href="appliances_page.html?search=Heating Pad">Heating Pads</a></li>
        <li><a href="appliances_page.html?search=Electric Blanket">Electric Blankets</a></li>
        <li><a href="appliances_page.html?search=Portable AC">Portable AC Units</a></li>
      </ul>
    </div>

    <div class="cat-group" onclick="this.classList.toggle('open')">
      <div class="cat-header"><i data-lucide="scissors"></i> <a
          href="appliances_page.html?category=Personal Care">Personal Care</a></div>
      <ul class="cat-list">
        <li><a href="appliances_page.html?search=Hair Dryer">Hair Dryers</a></li>
        <li><a href="appliances_page.html?search=Straightener">Hair Straighteners</a></li>
        <li><a href="appliances_page.html?search=Shaver">Electric Shavers</a></li>
        <li><a href="appliances_page.html?search=Trimmer">Beard Trimmers</a></li>
        <li><a href="appliances_page.html?search=Massage">Massage Guns</a></li>
        <li><a href="appliances_page.html?search=Toothbrush">Toothbrushes</a></li>
        <li><a href="appliances_page.html?search=Epilator">Epilators</a></li>
        <li><a href="appliances_page.html?search=Skin Care">Skin Care Devices</a></li>
      </ul>
    </div>

    <div class="cat-group" onclick="this.classList.toggle('open')">
      <div class="cat-header"><i data-lucide="home"></i> <a href="appliances_page.html?category=Smart Home">Smart
          Home</a></div>
      <ul class="cat-list">
        <li><a href="appliances_page.html?search=Smart Light">Smart Lights</a></li>
        <li><a href="appliances_page.html?search=Smart Plug">Smart Plugs</a></li>
        <li><a href="appliances_page.html?search=Camera">Security Cameras</a></li>
        <li><a href="appliances_page.html?search=Thermostat">Smart Thermostats</a></li>
        <li><a href="appliances_page.html?search=Voice Assistant">Voice Assistants</a></li>
        <li><a href="appliances_page.html?search=Lock">Smart Locks</a></li>
        <li><a href="appliances_page.html?search=Robot Mop">Robot Mops</a></li>
        <li><a href="appliances_page.html?search=Sensor">Smart Sensors</a></li>
      </ul>
    </div>

    <div class="cat-group" onclick="this.classList.toggle('open')">
      <div class="cat-header"><i data-lucide="zap"></i> <a href="appliances_page.html?category=Other Appliances">Other
          Appliances</a></div>
      <ul class="cat-list">
        <li><a href="appliances_page.html?search=Water Purifier">Water Purifiers</a></li>
        <li><a href="appliances_page.html?search=Iron">Irons & Steamers</a></li>
        <li><a href="appliances_page.html?search=Sewing">Sewing Machines</a></li>
        <li><a href="appliances_page.html?search=Kettle">Electric Kettles</a></li>
        <li><a href="appliances_page.html?search=Rice Cooker">Rice Cookers</a></li>
        <li><a href="appliances_page.html?search=Grill">Indoor Grills</a></li>
        <li><a href="appliances_page.html?search=Waffle">Waffle Makers</a></li>
        <li><a href="appliances_page.html?search=Steamer">Food Steamers</a></li>
      </ul>
    </div>
  </div>

  <div class="sidebar-overlay" id="overlay" onclick="toggleMenu()"></div>

  <!-- DESKTOP HEADER -->
  <header class="main-header" id="mainHeader">
    <nav class="navbar-container">
      <a href="../../index.html" class="logo">
        <img src="../../src/photos/logo_black.png" alt="Logo" class="logo-dark">
        <img src="../../src/photos/logo_w.png" alt="Logo" class="logo-light">
      </a>

      <div class="desktop-catalog">
        <button class="btn-catalog">
          <i data-lucide="layout-grid"></i> Catalog
        </button>
        <div class="mega-menu-desktop">
          <div class="menu-col">
            <h4><i data-lucide="utensils"></i> <a href="appliances_page.html?category=Kitchen Appliances">Kitchen
                Appliances</a></h4>
            <ul>
              <li><a href="appliances_page.html?search=Stand Mixers">Stand Mixers</a></li>
              <li><a href="appliances_page.html?search=Microwave">Microwave Ovens</a></li>
              <li><a href="appliances_page.html?search=Convection">Convection Ovens</a></li>
              <li><a href="appliances_page.html?search=Blender">Power Blenders</a></li>
              <li><a href="appliances_page.html?search=Air Fryer">Air Fryers</a></li>
              <li><a href="appliances_page.html?search=Food Processor">Food Processors</a></li>
              <li><a href="appliances_page.html?search=Coffee">Coffee Makers</a></li>
              <li><a href="appliances_page.html?search=Toaster">Toasters & Grills</a></li>
            </ul>
          </div>
          <div class="menu-col">
            <h4><i data-lucide="wind"></i> <a href="appliances_page.html?category=Cleaning Appliances">Cleaning
                Appliances</a></h4>
            <ul>
              <li><a href="appliances_page.html?search=Robot Vacuum">Robot Vacuums</a></li>
              <li><a href="appliances_page.html?search=Steam Cleaner">Steam Cleaners</a></li>
              <li><a href="appliances_page.html?search=Wet Vacuum">Wet/Dry Vacuums</a></li>
              <li><a href="appliances_page.html?search=Air Purifier">Air Purifiers</a></li>
              <li><a href="appliances_page.html?search=Pressure Washer">Pressure Washers</a></li>
              <li><a href="appliances_page.html?search=Handheld Vacuum">Handheld Vacuums</a></li>
              <li><a href="appliances_page.html?search=Carpet Cleaner">Carpet Cleaners</a></li>
              <li><a href="appliances_page.html?search=Window Cleaner">Window Cleaners</a></li>
            </ul>
          </div>
          <div class="menu-col">
            <h4><i data-lucide="thermometer"></i> <a href="appliances_page.html?category=Heating Appliances">Heating &
                Cooling</a></h4>
            <ul>
              <li><a href="appliances_page.html?search=Heater">Space Heaters</a></li>
              <li><a href="appliances_page.html?search=Fan">Ceiling Fans</a></li>
              <li><a href="appliances_page.html?search=Air Conditioner">Air Conditioners</a></li>
              <li><a href="appliances_page.html?search=Dehumidifier">Dehumidifiers</a></li>
              <li><a href="appliances_page.html?search=Cooler">Evaporative Coolers</a></li>
              <li><a href="appliances_page.html?search=Heating Pad">Heating Pads</a></li>
              <li><a href="appliances_page.html?search=Electric Blanket">Electric Blankets</a></li>
              <li><a href="appliances_page.html?search=Portable AC">Portable AC Units</a></li>
            </ul>
          </div>
          <div class="menu-col">
            <h4><i data-lucide="scissors"></i> <a href="appliances_page.html?category=Personal Care">Personal Care</a>
            </h4>
            <ul>
              <li><a href="appliances_page.html?search=Hair Dryer">Hair Dryers</a></li>
              <li><a href="appliances_page.html?search=Straightener">Hair Straighteners</a></li>
              <li><a href="appliances_page.html?search=Shaver">Electric Shavers</a></li>
              <li><a href="appliances_page.html?search=Trimmer">Beard Trimmers</a></li>
              <li><a href="appliances_page.html?search=Massage">Massage Guns</a></li>
              <li><a href="appliances_page.html?search=Toothbrush">Toothbrushes</a></li>
              <li><a href="appliances_page.html?search=Epilator">Epilators</a></li>
              <li><a href="appliances_page.html?search=Skin Care">Skin Care Devices</a></li>
            </ul>
          </div>
          <div class="menu-col">
            <h4><i data-lucide="home"></i> <a href="appliances_page.html?category=Smart Home">Smart Home</a>
            </h4>
            <ul>
              <li><a href="appliances_page.html?search=Smart Light">Smart Lights</a></li>
              <li><a href="appliances_page.html?search=Smart Plug">Smart Plugs</a></li>
              <li><a href="appliances_page.html?search=Camera">Security Cameras</a></li>
              <li><a href="appliances_page.html?search=Thermostat">Smart Thermostats</a></li>
              <li><a href="appliances_page.html?search=Voice Assistant">Voice Assistants</a></li>
              <li><a href="appliances_page.html?search=Lock">Smart Locks</a></li>
              <li><a href="appliances_page.html?search=Robot Mop">Robot Mops</a></li>
              <li><a href="appliances_page.html?search=Sensor">Smart Sensors</a></li>
            </ul>
          </div>
          <div class="menu-col">
            <h4><i data-lucide="zap"></i> <a href="appliances_page.html?category=Other Appliances">Other
                Appliances</a>
            </h4>
            <ul>
              <li><a href="appliances_page.html?search=Water Purifier">Water Purifiers</a></li>
              <li><a href="appliances_page.html?search=Iron">Irons & Steamers</a></li>
              <li><a href="appliances_page.html?search=Sewing">Sewing Machines</a></li>
              <li><a href="appliances_page.html?search=Kettle">Electric Kettles</a></li>
              <li><a href="appliances_page.html?search=Rice Cooker">Rice Cookers</a></li>
              <li><a href="appliances_page.html?search=Grill">Indoor Grills</a></li>
              <li><a href="appliances_page.html?search=Waffle">Waffle Makers</a></li>
              <li><a href="appliances_page.html?search=Steamer">Food Steamers</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="search-area">
        <form class="search-form" id="searchForm">
          <input aria-label="Search products" type="text" id="searchInput" placeholder="I'm shopping for..."
            autocomplete="off">
          <button type="submit" class="search-btn"><i data-lucide="search"></i></button>
        </form>
        <div class="search-results-dropdown">
          <!-- Search results will be dynamically loaded here -->
        </div>
      </div>

      <div class="user-nav">
        <!-- User Account -->
        <!-- User Account -->
        <a href="auth_page.html" class="nav-link" id="nav-auth-link">
          <i data-lucide="user"></i> <span>Account</span>
        </a>

        <a href="wishlist_page.html" class="nav-link">
          <i data-lucide="heart"></i> <span>Wishlist</span>
        </a>

        <!-- Cart -->
        <a href="cart_page.html" class="nav-link" style="position: relative;">
          <i data-lucide="shopping-cart"></i>
          Cart
          <span class="cart-badge" id="cart-count"
            style="display: none; background: red; color: white; font-size: 10px; border-radius: 50%; padding: 2px 6px;">0</span>
        </a>
      </div>
    </nav>
  </header>


  <!-- MAIN PROFILE CONTENT -->
  <main class="profile-container">

    <!-- Header -->
    <div class="profile-header-card">
      <div class="profile-avatar-container">
        <!-- User Provided Logo Link (via google redirect, simplified or used robust placeholder) -->
        <img src="https://i.pinimg.com/736x/3b/e5/ca/3be5caffe2962e53706b543fc8acec2e.jpg"
          onerror="this.src='https://i.ytimg.com/vi/ljtNk_5_5Uk/oar2.jpg?sqp=-oaymwEiCJwEENAFSFqQAgHyq4qpAxEIARUAAAAAJQAAyEI9AICiQw==&rs=AOn4CLCFTRaHHWwXgmDc8Sf-ZGlhXLU70Q'"
          alt="Profile" class="profile-avatar" id="user-avatar">
        <div class="membership-badge-overlay" id="user-tier-badge">Bronze</div>
      </div>
      <div class="profile-info">
        <h1 id="user-name">Loading...</h1>
        <p class="profile-email" id="user-email">...</p>
        <div class="join-date">
          <i data-lucide="calendar" size="14"></i>
          Joined <span id="user-joined">...</span>
        </div>
      </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard-grid">
      <!-- Membership Status -->
      <div class="membership-card">
        <div class="membership-info">
          <span style="text-transform:uppercase; font-size:0.8rem; color:var(--text-sec); letter-spacing:1px;">Current
            Plan</span>
          <h3 id="current-plan-name">Bronze Member</h3>
          <p style="color: #666; font-size: 0.95rem;">Enjoying basic rewards.</p>

          <div class="membership-progress">
            <div class="progress-bar">
              <div class="progress-fill" style="width: 25%;"></div>
            </div>
            <span class="next-tier-text">Loading progress...</span>
          </div>
        </div>
        <div class="tier-icon">
          <i data-lucide="award" size="32"></i>
        </div>
      </div>

      <!-- Points -->
      <div class="points-card">
        <div class="points-val" id="user-points">0</div>
        <div class="points-label">Loyalty Points</div>
      </div>
    </div>

    <!-- Action Menu -->
    <div class="menu-grid">
      <a href="wishlist_page.html" class="menu-btn">
        <div class="menu-icon"><i data-lucide="heart"></i></div>
        <span class="menu-text">My Wishlist</span>
      </a>
      <a href="purchases_history.html" class="menu-btn">
        <div class="menu-icon"><i data-lucide="package"></i></div>
        <span class="menu-text">Order History</span>
      </a>
      <a href="#" class="menu-btn" onclick="showToast('Feature coming soon!', 'info')">
        <div class="menu-icon"><i data-lucide="settings"></i></div>
        <span class="menu-text">Account Settings</span>
      </a>
      <a href="#" class="menu-btn" onclick="showToast('Feature coming soon!', 'info')">
        <div class="menu-icon"><i data-lucide="credit-card"></i></div>
        <span class="menu-text">Payment Methods</span>
      </a>
    </div>

    <div class="logout-btn">
      <button class="btn-logout" onclick="window.Auth.logout()">Log Out</button>
    </div>

  </main>

  <!-- Footer (Global) -->
  <footer class="main-footer">
    <div class="footer-container">
      <div class="footer-col">
        <h4>Shopping Guide</h4>
        <ul>
          <li><a href="#">How to buy</a></li>
          <li><a href="#">Payment methods</a></li>
          <li><a href="#">Shipping & Delivery</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <h4>Customer Service</h4>
        <ul>
          <li><a href="#">Help Center</a></li>
          <li><a href="#">Refund Policy</a></li>
          <li><a href="#">Contact Us</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <h4>Stay Connected</h4>
        <div class="social-icons">
          <i data-lucide="facebook"></i>
          <i data-lucide="instagram"></i>
          <i data-lucide="twitter"></i>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      &copy; 2026 Tech House. All rights reserved.
    </div>
  </footer>

  <!-- MOBILE BOTTOM NAV -->
  <div class="mobile-bar">
    <a href="../../index.html" class="mobile-nav-item">
      <i data-lucide="home"></i> <span>Home</span>
    </a>
    <div class="mobile-nav-item" onclick="toggleMenu()">
      <i data-lucide="layout-grid"></i> <span>Catalog</span>
    </div>
    <a href="wishlist_page.html" class="mobile-nav-item">
      <i data-lucide="heart"></i> <span>Wishlist</span>
    </a>
    <a href="cart_page.html" class="mobile-nav-item">
      <i data-lucide="shopping-cart"></i> <span>Cart</span>
      <span class="cart-badge">0</span>
    </a>
    <a href="auth_page.html" class="mobile-nav-item active">
      <i data-lucide="user"></i> <span>Account</span>
    </a>
  </div>

  <!-- Scripts -->
  <script src="../data/products.js"></script>
  <script src="../scripts/auth.js"></script>
  <script src="../scripts/cartManager.js"></script>
  <script src="../scripts/profile.js"></script>
  <script src="../scripts/toast.js"></script>
  <script>
    // Initialize Icons
    if (window.lucide) lucide.createIcons();

    // Menu Toggle
    function toggleMenu() {
      const sidebar = document.getElementById('mobileSidebar');
      const overlay = document.getElementById('overlay');
      if (sidebar && overlay) {
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
        document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : 'auto';
      }
    }

    // Header Scroll Effect
    window.addEventListener('scroll', () => {
      const header = document.getElementById('mainHeader');
      if (header) {
        if (window.scrollY > 50) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }
      }
    });

    // Search Functionality
    let searchTimeout;

    function highlightText(text, query) {
      if (!query) return text;
      const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      return text.replace(regex, '<span class="highlight">$1</span>');
    }

    function searchProducts(query) {
      if (!query || query.length < 2) return [];

      const searchTerms = query.toLowerCase().split(' ').filter(t => t.length > 0);

      return window.products.filter(product => {
        const searchableText = `
          ${product.name} 
          ${product.category} 
          ${product.brand} 
          ${product.description || ''}
        `.toLowerCase();

        return searchTerms.some(term => searchableText.includes(term));
      }).sort((a, b) => {
        const aNameMatch = a.name.toLowerCase().includes(query.toLowerCase());
        const bNameMatch = b.name.toLowerCase().includes(query.toLowerCase());
        if (aNameMatch && !bNameMatch) return -1;
        if (!aNameMatch && bNameMatch) return 1;
        return 0;
      });
    }

    function showSearchResults(results, query) {
      const dropdown = document.querySelector('.search-results-dropdown');
      if (!dropdown) return;

      if (results.length === 0) {
        dropdown.innerHTML = `
          <div class="search-no-results">
            <i data-lucide="search-x"></i>
            <p>No products found for "${query}"</p>
            <p style="font-size: 12px; color: #999;">Try different keywords</p>
          </div>
        `;
        dropdown.style.display = 'block';
        if (window.lucide) lucide.createIcons();
        return;
      }

      const maxResults = 5;
      const displayResults = results.slice(0, maxResults);
      const hasMore = results.length > maxResults;

      let html = '<div class="search-results">';

      displayResults.forEach(product => {
        const price = `${product.price.toLocaleString('en-US')} UZS`;
        const image = Array.isArray(product.images) ? product.images[0] : (product.image ? product.image[0] : '/src/assets/images/placeholder.jpg');
        const highlightedName = highlightText(product.name, query);

        html += `
          <a href="appliance_details_page.html?id=${product.id}" class="search-result-item">
            <img src="${image}" alt="${product.name}" class="search-result-image" onerror="this.src='/src/assets/images/placeholder.jpg'">
            <div class="search-result-details">
              <div class="search-result-name">${highlightedName}</div>
              <div class="search-result-meta">
                <span class="search-result-category">${product.category}</span>
              </div>
              <div class="search-result-price">${price}</div>
            </div>
          </a>
        `;
      });

      if (hasMore) {
        html += `
          <a href="appliances_page.html?search=${encodeURIComponent(query)}" class="search-see-more">
            See all ${results.length} results â†’
          </a>
        `;
      }

      html += '</div>';
      dropdown.innerHTML = html;
      dropdown.style.display = 'block';
      if (window.lucide) lucide.createIcons();
    }

    function handleSearchSubmit(e) {
      e.preventDefault();
      const input = document.getElementById('searchInput');
      const query = input ? input.value.trim() : '';
      if (query) {
        window.location.href = `appliances_page.html?search=${encodeURIComponent(query)}`;
      } else {
        window.location.href = 'appliances_page.html';
      }
    }

    // DOMContentLoaded Setup
    document.addEventListener('DOMContentLoaded', () => {
      // Catalog Button
      const catalogBtn = document.querySelector('.btn-catalog');
      if (catalogBtn) {
        catalogBtn.onclick = () => window.location.href = 'appliances_page.html';
      }

      // Search Listeners
      const searchInput = document.getElementById('searchInput');
      const searchForm = document.getElementById('searchForm');
      const dropdown = document.querySelector('.search-results-dropdown');

      if (searchInput && searchForm) {
        searchInput.addEventListener('input', (e) => {
          const query = e.target.value.trim();
          clearTimeout(searchTimeout);

          if (query.length < 2) {
            if (dropdown) dropdown.style.display = 'none';
            return;
          }

          searchTimeout = setTimeout(() => {
            const results = searchProducts(query);
            showSearchResults(results, query);
          }, 300);
        });

        searchForm.addEventListener('submit', handleSearchSubmit);
      }

      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        const searchArea = document.querySelector('.search-area');
        if (dropdown && searchArea && !searchArea.contains(e.target)) {
          dropdown.style.display = 'none';
        }
      });

      // Mobile Menu Links
      document.querySelectorAll('.cat-list a').forEach(link => {
        link.addEventListener('click', toggleMenu);
      });

      // Sidebar overlay listener
      const overlay = document.getElementById('overlay');
      if (overlay) {
        overlay.addEventListener('click', toggleMenu);
      }
    });
  </script>
</body>

</html>